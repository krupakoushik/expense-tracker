{% extends "base.html" %} 

{% block title %}Home{% endblock %}

{% block content %}

    <h1 align="center">Hello {{ current_user.username.capitalize() }}!</h1>
    <p align="center"><small class="text-body-secondary">ðŸ’° Current Balance: </small><b>{{ balance }}</b></p>

    <div id="addForm" style="display:none; margin-top: 10px; border: 1px solid #ccc ; padding: 15px">
    <form method="POST" action="{{ url_for('views.home') }}">

        <label for="date">Date:</label>
        <input type="date" name="date" required>
        
        <label for="txn">Type:</label>
        <select name="txn" required>
            <option value="CREDIT">Credit</option>
            <option value="DEBIT">Debit</option>
        </select>
        
        <label for="amount">Amount:</label>
        <input type="number" step="0.01" name="amount" placeholder="Amount" required>
        

        <label for="category_id">Category:</label>
        <select name="category_id">
            {% for cat in categories %}
                <option value="{{ cat.id }}">{{ cat.name }}</option>
            {% endfor %}
        </select>


        <label for="note">Note:</label>
        <input type="text" name="note" placeholder="Note">
        
        <input type="submit" value="Submit">
    </form>
    </div>

    <table class="table">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="mb-0"><b>All Transactions</b></h4>
            <a href="#" class="btn">
                <button onclick="toggleForm()" id="toggleBtn">âž• Add Transaction</button>
            </a>
        </div>
        <thead align="center" class="table-dark">
        <tr>
            <th scope="col">ID</th>
            <th scope="col">Date</th>
            <th scope="col">Type</th>
            <th scope="col">Amount</th>
            <th scope="col">Category</th>
            <th scope="col">Note</th>
            <th scope="col">Actions</th>
        </tr>
        </thead>
        <tbody class="table-group-divider" align="center">
        {% for t in transaction %}
        <tr>
            <th>{{ t.id }}</th>
            <th>{{ t.txn_date.strftime('%d-%m-%Y') if t.txn_date else '' }}</th>
            <th>{{ t.txn.capitalize() }}</th>
            <th>{{ t.amount }}</th>
            <th>
                <form method="POST" action="{{ url_for('views.update_category', id=t.id) }}">
                    <select name="category_id" class="form-select form-select-sm" onchange="this.form.submit()">
                        {% for c in categories %}
                            <option value="{{ c.id }}" {% if t.category_id == c.id %}selected{% endif %}>
                                {{ c.name.capitalize() }}
                            </option>
                        {% endfor %}
                    </select>
                </form>
            </th>
            <th>{{ t.note.capitalize() }}</th>
            <th>
                <a class="btn btn-dark btn-sm" href="/edit/{{ t.id }}" role="button">Edit</a>
                <a class="btn btn-dark btn-sm" href="/delete/{{ t.id }}" role="button">Delete</a>
            </th>
        </tr>
        {% endfor %}
        </tbody>
    </table>



    <script>
        function toggleForm(){
            let form = document.getElementById("addForm");
            let btn = document.getElementById("toggleBtn");

            if (form.style.display === "none"){
                form.style.display = "block";
                btn.textContent = "âž– Hide Form";
            }
            else {
                form.style.display = "none";
                btn.textContent = "âž• Add Transaction";
            }
        }
    </script>




{% endblock %}