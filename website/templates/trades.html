{% extends "base.html" %} 

{% block title %}Home{% endblock %}

{% block content %}

    <h1 align="center">Hello {{ current_user.username.capitalize() }}!</h1>


    <div class="d-flex justify-content-between align-items-center mb-3">
                <h4 class="mb-0"><b>{{ trades.coin_id }} Transactions</b></h4>
                <a href="{{ url_for('views.portfolio') }}" class="btn btn-dark fw-bold">View Full Portfolio</a>
    </div>

    <!-- Portfolio Table -->
    <table class="table table-hover table-dark align-items-center">
        <thead align="center" class="table-dark">
        <tr>
            <th scope="col" class="text-start">Type</th>
            <th scope="col" class="text-start">Price</th>
            <th scope="col" class="text-end">Quantity</th>
            <th scope="col" class="text-end">Date & Time</th>
            <th scope="col" class="text-end">Total (Cost/Proceeds)</th>
            <th scope="col" class="text-end">PnL</th>
            <th scope="col">Actions</th>
        </tr>
        </thead>
        <tbody class="table-group-divider" align="center">
        {% for t in trades %}
            <tr>
                <td class="text-start">
                    {% if t.side == 'BUY' %}
                    <span class="text-success">{{ t.side }}</span>
                    {% elif t.side == 'SELL' %}
                    <span class="text-danger">{{ t.side }}</span>
                    {% endif %}
                </td>

                <td class="text-start">₹{{ "{:,.2f}".format(t.price_per_coin) }}</td>

                <td class="text-end">
                    {% if t.side == 'BUY' %}
                    <span class="text-success">+{{ t.quantity|fmtqty(8) }}</span>
                    {% elif t.side == 'SELL' %}
                    <span class="text-danger">-{{ t.quantity|fmtqty(8) }}</span>
                    {% endif %}
                </td>

                <td class="text-end">{{ t.txn_date }}</td>

                <td class="text-end">₹{{ t.total }}</td>

                <td class="text-end">
                {% if t.side == 'SELL' %}
                    {% set r = fifo_realized.get(t.id, 0) %}
                    <span class="text-{{ 'success' if r >= 0 else 'danger' }}">
                    ₹{{ "{:,.2f}".format(r) }}
                    </span>
                {% else %}
                    —
                {% endif %}
                </td>


                <td>
                <button type="button" class="btn btn-dark fw-bold"
                        data-bs-toggle="modal" data-bs-target="#addCryptoTransactionForm">
                    <i class="fa-solid fa-pen"></i>
                </button>
                <a href="#" class="btn btn-dark fw-bold"
                    onclick="return confirm('Are you sure you want to delete this trade?');">
                    <i class="fa-solid fa-trash"></i>
                </a>
                </td>
            </tr>
        {% endfor %}

        </tbody>
    </table>

    


{% endblock %}
